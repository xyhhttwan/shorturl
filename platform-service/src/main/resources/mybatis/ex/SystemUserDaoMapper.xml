<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.soft.service.dao.backstage.ex.ISystemUserDAO">
    <!--
         符号转义说明
    &lt;          <
    &gt;          >
    &lt;&gt;     <>
    &amp;        &
    &apos;       '
    &quot;       "
  <![CDATA[ 这里写你的SQL或者符号 ]]>
 -->
    <!-- 对象映射 -->
    <resultMap type="com.platform.soft.domain.backstage.ex.SystemUser" id="userMap" />

    <!-- tbaleColumns  所有列 -->
    <sql id="tbaleAllColumns">
        id,<include refid="tbaleColumns"/>
    </sql>
    <sql id="tbaleColumns">
        systemName,password,realName,IDCard,sex,phone,entryDate,status
    </sql>
    <!-- insertParams  入库操作 -->
    <sql id="insertParams">
        #{systemName},#{password},#{realName},#{IDCard},#{sex},#{phone},#{entryDate},#{status}
    </sql>

    <!-- updateParams  更新操作 -->
    <sql id="updateParams">
        realName=#{realName},IDCard=#{IDCard},sex=#{sex},phone=#{phone},entryDate=#{entryDate},status=#{status}
    </sql>
    <!-- params  查询参数 -->
    <sql id="params">
        and password=#{password}
        and systemName=#{userName}
    </sql>

    <!-- where 条件  -->
    <sql id="where">
        where 1=1
    </sql>
    <!-- columnKey  主键  -->
    <sql id="columnKey">
        and id=#{id}
    </sql>

    <!-- 条件 查询  , 去掉主键列-->
    <sql id="andOther">
        <trim  suffixOverrides="," >

            <if test="systemName != null and systemName !='' ">
                and systemName =  #{systemName}
            </if>

            <if test="realName != null and realName !='' ">
                and realName =  #{realName}
            </if>

            <if test="IDCard != null and IDCard !='' ">
                and IDCard =  #{IDCard}
            </if>

            <if test="sex != null and sex !='' ">
                and sex =  #{sex}
            </if>

            <if test="phone != null and phone !='' ">
                and phone =  #{phone}
            </if>

            <if test="entryDate != null and entryDate !='' ">
                and entryDate =  #{entryDate}
            </if>

            <if test="status != null and status !='' ">
                and status =  #{status}
            </if>

        </trim>
    </sql>
    <!--排序用-->
    <sql id="orderBy">
        ORDER BY  entryDate asc
    </sql>
    <!--用户登录-->
   <select id="login" resultMap="userMap">
       SELECT
       <include refid="tbaleAllColumns"/>
       FROM
        systemUser
       <include refid="where"/>
       <include refid="params"/>
   </select>

    <!--用户列表分页-->
    <select id="getUserPageList" parameterType="map" resultMap="userMap">
        SELECT
        <include refid="tbaleAllColumns"/>
        FROM
        systemUser
        <include refid="where"/>
        <include refid="andOther"/>
        <include refid="orderBy"/>

    </select>

    <!-- 新增用户 -->
    <insert id="addSystemUser" parameterType="SystemUser">
        INSERT INTO systemUser
        (<include refid="tbaleColumns"/>)
        VALUES
        (<include refid="insertParams"/>);
    </insert>

    <!-- 更新用户 -->
    <update id="updateUser" parameterType="SystemUser">
        UPDATE systemUser SET
        <include refid="updateParams"/>
        <include refid="where"/>
        <include refid="columnKey"/>
    </update>

    <!-- 根据id查询用户信息 -->
    <select id="getUserById" parameterType="int" resultMap="userMap">
        SELECT
        <include refid="tbaleAllColumns"/>
        FROM systemUser
        <include refid="where"/>
        <include refid="columnKey"/>
    </select>

    <!--根据用户名查找该用户是否存在-->
    <select id="checkUserName" parameterType="String" resultType="map">
      SELECT  systemName from systemUser where systemName=#{systemName}
    </select>
    <!-- 根据id删除用户 -->
    <delete id="delUser" parameterType="int">
        DELETE FROM systemUser
        <include refid="where"/>
        <include refid="columnKey"/>
    </delete>
    <!--修改密码-->
    <update id="updateUserPwd" parameterType="map" >
        UPDATE systemUser SET password=#{password}
        <include refid="where"/>
        <include refid="columnKey"/>
    </update>

    <!--维护用户与角色关系begain-->

    <!--根据用户id查询该用户的角色信息-->
    <select id="getRoleListByUserId" parameterType="int" resultType="map">
        SELECT
        bb.id as roleId,bb.roleName,aa.id as userId
        FROM
        systemUser aa ,role bb,userRole cc
        WHERE
        aa.id=cc.userId
        AND  bb.id=cc.roleId
        AND  aa.id=#{userId}

    </select>
    <!--根据用户id删除该用户的角色信息-->
    <delete id="delUserRole" parameterType="int">
         DELETE
         FROM userRole
         where userId=#{userId}
    </delete>

    <!--新增角色-->
    <insert id="addUserRole" parameterType="map">
        INSERT  INTO userRole
        (roleId,userId)
        VALUES (#{roleId},#{userId})
    </insert>


    <!--维护用户与角色关系end-->

</mapper>
